<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Nepal GK Quiz | Ujwal Pandey</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">
</head>

<body>

<!-- START SCREEN -->
<div id="startScreen" class="start-screen">
  <div class="start-box">
    <img src="https://i.ibb.co/M6dM5Q3/nepal-flag.gif" class="flag">
    <h1>Nepal GK Official Quiz</h1>
    <p>Test your knowledge ‚Ä¢ Secure Proctored Quiz</p>
    <button class="start-btn" onclick="beginQuiz()">Start Quiz</button>
  </div>
</div>

<!-- QUIZ -->
<div id="quizContainer" class="quiz-container hidden">
  <div class="header">
    <h2>üá≥üáµ Nepal GK Secure Quiz</h2>
    <span id="timer">‚è± 05:00</span>
  </div>

  <form id="quizForm">
    <input type="text" id="playerName" placeholder="Full Name" required>
    <input type="email" id="playerEmail" placeholder="Email" required>

    <div id="questions-wrapper"></div>

    <button type="button" id="submitBtn" onclick="submitQuiz()">Submit Quiz</button>
    <div id="resultBox"></div>
  </form>
</div>

<!-- SOUND -->
<audio id="tickSound" src="tick.mp3"></audio>
<audio id="timeUpSound" src="timeup.mp3"></audio>

<script>

/* ==========================
   QUIZ START + ANTI-CHEAT
========================== */
let quizStarted = false;

function beginQuiz() {
  document.getElementById("startScreen").classList.add("hidden");
  document.getElementById("quizContainer").style.display = "block";
  quizStarted = true;  // Enable anti-cheat
}

/* Anti-cheat: only works AFTER quiz starts */
window.onblur = () => {
  if (quizStarted) {
    alert("‚ö†Ô∏è Tab switch detected! Auto-submitting your quiz.");
    submitQuiz();
  }
};

/* ==========================
   QUIZ DATA
========================== */
const quizData = [
  { q:"‡§®‡•á‡§™‡§æ‡§≤‡§Æ‡§æ ‡§™‡§π‡§ø‡§≤‡•ã ‡§∞‡•á‡§≤ ‡§∏‡•á‡§µ‡§æ ‡§ï‡§π‡§æ‡§Å ‡§∏‡•Å‡§∞‡•Å ‡§≠‡§Ø‡•ã?<br>First railway?", options:["Raxaul ‚Äì Amlekhganj","Birgunj ‚Äì Simara","Janakpur ‚Äì Jaynagar","Biratnagar ‚Äì Rangeli"], correct:"Raxaul ‚Äì Amlekhganj" },
  { q:"‡§™‡§π‡§ø‡§≤‡•ã ‡§ú‡§≤‡§µ‡§ø‡§¶‡•ç‡§Ø‡•Å‡§§ ‡§Ü‡§Ø‡•ã‡§ú‡§®‡§æ?<br>First hydro project?", options:["Pharping","Trishuli","Kulekhani","Sunkoshi"], correct:"Pharping" },
  { q:"‡§™‡§π‡§ø‡§≤‡•ã ‡§¨‡•à‡§Ç‡§ï?<br>First bank?", options:["Nepal Bank Limited","Nepal Rastra Bank","ADB Bank","Rastriya Banijya Bank"], correct:"Nepal Bank Limited" },
  { q:"‡§™‡§π‡§ø‡§≤‡•ã ‡§∏‡§Ç‡§µ‡§ø‡§ß‡§æ‡§®?<br>First constitution?", options:["1948 A.D.","1951 A.D.","1962 A.D.","1990 A.D."], correct:"1948 A.D." },
  { q:"UN ‡§∏‡§¶‡§∏‡•ç‡§Ø‡§§‡§æ?<br>Nepal joined UN?", options:["1955 A.D.","1950 A.D.","1957 A.D.","1961 A.D."], correct:"1955 A.D." },
  { q:"‡§™‡§π‡§ø‡§≤‡•ã ‡§µ‡§ø‡§∂‡•ç‡§µ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§≤‡§Ø?<br>First university?", options:["Tribhuvan University","Kathmandu University","Purbanchal University","MWU"], correct:"Tribhuvan University" },
  { q:"‡§™‡§π‡§ø‡§≤‡•ã ‡§®‡•á‡§™‡§æ‡§≤‡•Ä ‡§ö‡§≤‡§ö‡§ø‡§§‡•ç‡§∞?<br>First Nepali filmed movie?", options:["Aama","Satya Harischandra","Maitighar","Harischandra"], correct:"Aama" },
  { q:"‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡§ø‡§Ø ‡§∏‡§≠‡§æ ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ?<br>National Assembly members?", options:["59","56","60","61"], correct:"59" },
  { q:"‡§™‡§π‡§ø‡§≤‡•ã ‡§ú‡§®‡§ó‡§£‡§®‡§æ?<br>First census year?", options:["1911 A.D.","1941 A.D.","1952 A.D.","1961 A.D."], correct:"1911 A.D." },
  { q:"SAARC ‡§ö‡§æ‡§∞‡•ç‡§ü‡§∞ ‡§∏‡§æ‡§á‡§®?<br>SAARC signed?", options:["8 December 1985","6 January 1984","10 December 1986","1 Nov 1985"], correct:"8 December 1985" },
  { q:"‡§™‡§π‡§ø‡§≤‡•ã ‡§Ü‡§®‡•ç‡§§‡§∞‡§ø‡§ï ‡§â‡§°‡§æ‡§®?<br>First domestic flight?", options:["1950 A.D., Kathmandu‚ÄìSimara","1949 A.D., Kathmandu‚ÄìPokhara","1950 A.D., Kathmandu‚ÄìBiratnagar","1951 A.D., Kathmandu‚ÄìJanakpur"], correct:"1950 A.D., Kathmandu‚ÄìSimara" }
];

/* Shuffle */
function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

shuffle(quizData);
quizData.forEach(q => q.options = shuffle(q.options));

/* Display Questions */
const wrapper = document.getElementById("questions-wrapper");

quizData.forEach((q, i) => {
  const div = document.createElement("div");
  div.classList.add("question");

  let html = `<h3>${i + 1}. ${q.q}</h3>`;
  q.options.forEach(opt => {
    html += `<label><input type="radio" name="q${i}" value="${opt}"> ${opt}</label>`;
  });

  div.innerHTML = html;
  wrapper.appendChild(div);
});

/* ==========================
   TIMER
========================== */
let timeLeft = 300;
const timerDisplay = document.getElementById("timer");

const countdown = setInterval(() => {
  const m = Math.floor(timeLeft / 60);
  const s = timeLeft % 60;

  timerDisplay.textContent = `‚è± ${m.toString().padStart(2, "0")}:${s.toString().padStart(2, "0")}`;

  if (timeLeft <= 10 && timeLeft > 0) {
    document.getElementById("tickSound").play();
  }

  timeLeft--;
  if (timeLeft < 0) {
    document.getElementById("timeUpSound").play();
    clearInterval(countdown);
    submitQuiz();
  }
}, 1000);

/* ==========================
   SUBMIT QUIZ
========================== */
async function submitQuiz() {
  clearInterval(countdown);
  document.getElementById("submitBtn").disabled = true;

  const name = document.getElementById("playerName").value.trim();
  const email = document.getElementById("playerEmail").value.trim();

  if (!name || !email) {
    alert("Please enter your name and email.");
    return;
  }

  let score = 0;
  let details = [];

  quizData.forEach((q, i) => {
    const sel = document.querySelector(`input[name="q${i}"]:checked`);
    const userAns = sel ? sel.value : "Not answered";
    const correct = userAns === q.correct;

    if (correct) score++;

    details.push({
      question: q.q,
      user: userAns,
      correctAns: q.correct,
      correct
    });
  });

  const percent = ((score / quizData.length) * 100).toFixed(2);
  let badge = "";

  if (percent >= 90) badge = "ü•á Gold Badge ‚Äì Excellent!";
  else if (percent >= 70) badge = "ü•à Silver Badge ‚Äì Very Good!";
  else if (percent >= 50) badge = "ü•â Bronze Badge ‚Äì Good Effort!";
  else badge = "‚ùå Try Again ‚Äì Keep practicing!";

  document.getElementById("resultBox").innerHTML = `
    <h3>${name}, your result:</h3>
    <p>Score: ${score}/${quizData.length} (${percent}%)</p>
    <h2>${badge}</h2>
    <p>Results have been emailed to you.</p>
  `;
  document.getElementById("resultBox").style.display = "block";

  /* SEND TO GOOGLE SCRIPT */
  await fetch("https://script.google.com/macros/s/AKfycbwQpIgyZx1a0LrWw3Ez56HTFUebC43rkiM3c98yK0wAPfs67Lq_9usQ7TCjbdgxRDwB3Q/exec", {
    method: "POST",
    mode: "no-cors",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      name,
      email,
      score,
      percent,
      badge,
      total: quizData.length,
      answersDetailed: details
    })
  });

  alert("‚úÖ Your results have been emailed!");
}

</script>

</body>
</html>
